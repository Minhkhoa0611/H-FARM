<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Qu·∫£n l√Ω s·∫£n ph·∫©m H-FARM</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
   <script src="https://cdn.jsdelivr.net/npm/qr-code-styling@1.5.0/lib/qr-code-styling.js"></script>
   <style>
        body { font-family: 'Be Vietnam Pro', Arial, sans-serif; background: #f8f8f8; margin: 0; padding: 0; }
        .container { max-width: 950px; margin: 32px auto; background: #fff; border-radius: 12px; box-shadow: 0 2px 12px #b6e5b6; padding: 32px 24px 24px 24px; }
        h1 { text-align: center; color: #388e3c; margin-bottom: 24px; }
        .main-flex { display: flex; gap: 32px; flex-wrap: wrap; }
        .form-side { flex: 1 1 320px; min-width: 300px; }
        .list-side { flex: 2.5 1 600px; min-width: 420px; max-width: 100%; } /* tƒÉng flex v√† min-width */
        .form-group { margin-bottom: 16px; }
        label { font-weight: 500; display: block; margin-bottom: 6px; }
        input[type="text"], textarea { width: 100%; padding: 8px; border-radius: 6px; border: 1px solid #b6e5b6; font-size: 1em; }
        textarea { min-height: 60px; }
        button { background: #43a047; color: #fff; font-weight: 600; border: none; border-radius: 6px; padding: 8px 18px; margin-right: 8px; cursor: pointer; font-size: 1em; }
        button:hover { background: #388e3c; }
        table { width: 100%; border-collapse: collapse; margin-top: 12px; table-layout: auto; }
        th, td { border: 1px solid #b6e5b6; padding: 8px 6px; text-align: left; }
        th { background: #e8fbe8; color: #388e3c; }
        tr:nth-child(even) { background: #f8fff8; }
        .actions button { margin-right: 4px; }
        .footer { margin-top: 32px; text-align: center; color: #388e3c; font-weight: 600; letter-spacing: 1px; font-size: 1.05em; opacity: 0.85; }
        @media (max-width: 900px) {
            .main-flex { flex-direction: column; gap: 0; }
            .form-side, .list-side { width: 100%; min-width: 0; max-width: 100%; }
        }
        nav { width: 100%; background: #eafbe7; padding: 12px 0 10px 0; box-shadow: 0 2px 8px rgba(45,122,45,0.04); margin-bottom: 12px; }
        nav div { max-width: 900px; margin: 0 auto; display: flex; align-items: center; justify-content: flex-end; gap: 12px; }
        nav a { color: #217a21; font-weight: bold; text-decoration: none; font-size: 1.08em; padding: 7px 18px; border-radius: 6px; transition: background 0.2s; }
    </style>
</head>
<body>
    <nav style="width:100%;background:#eafbe7;padding:12px 0 10px 0;box-shadow:0 2px 8px rgba(45,122,45,0.04);margin-bottom:12px;">
            <div style="max-width:900px;margin:0 auto;display:flex;align-items:center;justify-content:flex-end;gap:12px;">
            <a href="danhsachsanpham.html" style="color:#217a21;font-weight:bold;text-decoration:none;font-size:1.08em;padding:7px 18px;border-radius:6px;transition:background 0.2s;">
                DANH M·ª§C S·∫¢N PH·∫®M
            </a>
        <div style="max-width:900px;margin:0 auto;display:flex;align-items:center;justify-content:flex-end;gap:12px;">
            <a href="index.html" style="color:#217a21;font-weight:bold;text-decoration:none;font-size:1.08em;padding:7px 18px;border-radius:6px;transition:background 0.2s;">
                T·∫†O S·∫¢N PH·∫®M
            </a>
                <a href="taodanhmuc.html" style="color:#217a21;font-weight:bold;text-decoration:none;font-size:1.08em;padding:7px 18px;border-radius:6px;transition:background 0.2s;">
                T·∫†O DANH M·ª§C
            </a>

            <a href="https://minhkhoa0611.github.io/quanlynhansu/QRSCANNER/qr-scanner.html" style="color:#217a21;font-weight:bold;text-decoration:none;font-size:1.08em;padding:7px 18px;border-radius:6px;transition:background 0.2s;">
                QR SCANNER
            </a>
            <a href="https://www.canva.com/design/DAGr5jzmJAw/ZmChp88aCMXM8vCpzuS4_A/edit?utm_content=DAGr5jzmJAw&utm_campaign=designshare&utm_medium=link2&utm_source=sharebutton"
               style="color:#217a21;font-weight:bold;text-decoration:none;font-size:1.08em;padding:7px 18px;border-radius:6px;transition:background 0.2s;">
                CANVA THI·∫æT K·∫æ
            </a>
        </div>
    </nav>
    <div class="container">
        <h1>Qu·∫£n l√Ω s·∫£n ph·∫©m H-FARM</h1>
        <div class="main-flex">
            <div class="form-side">
                <form id="productForm" enctype="multipart/form-data">
                    <input type="hidden" id="editIndex" value="">
                    <div class="form-group">
                        <label for="prodTitle">T√™n s·∫£n ph·∫©m</label>
                        <input type="text" id="prodTitle" required>
                    </div>
                    <div class="form-group">
                        <label for="prodLink">ƒê∆∞·ªùng d·∫´n (URL)</label>
                        <input type="text" id="prodLink" placeholder="https://minhkhoa0611.github.io/H-FARM/posts/abc.html" required>
                    </div>
                    <div class="form-group">
                        <label for="prodCategory">Danh m·ª•c</label>
                        <input type="text" id="prodCategory" placeholder="V√≠ d·ª•: D·∫ßu & M·∫≠t" required>
                    </div>
                    <div class="form-group">
                        <label for="prodNote">Ghi ch√∫ (tu·ª≥ ch·ªçn)</label>
                        <textarea id="prodNote"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="prodImage">H√¨nh ·∫£nh (tu·ª≥ ch·ªçn)</label>
                        <input type="file" id="prodImage" accept="image/*">
                        <div id="prodImagePreview" style="margin-top:8px;"></div>
                    </div>
                    <div class="form-group">
                        <label>Gi√° b√°n (c√≥ th·ªÉ nh·∫≠p nhi·ªÅu m·ª©c gi√°/dung t√≠ch)</label>
                        <div id="price-list">
                            <!-- C√°c d√≤ng gi√° s·∫Ω ƒë∆∞·ª£c th√™m ·ªü ƒë√¢y -->
                        </div>
                        <button type="button" id="addPriceBtn" style="background:#81c784;color:#fff;margin-top:6px;">+ Th√™m m·ª©c gi√°</button>
                    </div>
                    <button type="submit" id="saveBtn">Th√™m m·ªõi</button>
                    <button type="button" id="resetBtn" style="background:#bdbdbd;color:#333;">L√†m l·∫°i</button>
                </form>
            </div>
            <div class="list-side">
                <h2 style="margin-top:0;font-size:1.2em;color:#388e3c;">Danh s√°ch s·∫£n ph·∫©m</h2>
                <button type="button" id="saveToGithubBtn" style="margin-bottom:18px;">L∆∞u L√™n M√°y Ch·ªß</button>
                <div id="github-progress" style="margin-bottom:8px;color:#388e3c;font-size:1em;"></div>
                <div id="github-link" style="margin-bottom:12px;font-size:1.05em;"></div>
                <table id="productTable">
                    <thead>
                        <tr>
                            <th>T√™n s·∫£n ph·∫©m</th>
                            <th>Danh m·ª•c</th>
                            <th>ƒê∆∞·ªùng d·∫´n</th>
                            <th>T√™n file</th>
                            <th>Ghi ch√∫</th>
                            <th>H√¨nh ·∫£nh</th>
                            <th>Gi√°</th>
                            <th>Thao t√°c</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- D·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c render ·ªü ƒë√¢y -->
                    </tbody>
                </table>
            </div>
        </div>
        <div class="footer">H'FARM - 95 QU·∫¢NG ƒê·ª®C - NHA TRANG  - KH√ÅNH H√íA</div>
    </div>
    <!-- Modal QR -->
    <div id="qrModal" style="display:none;position:fixed;z-index:9999;left:0;top:0;width:100vw;height:100vh;background:rgba(0,0,0,0.25);align-items:center;justify-content:center;">
        <div style="background:#fff;padding:24px 32px 18px 32px;border-radius:12px;box-shadow:0 2px 16px #b6e5b6;min-width:260px;position:relative;">
            <div id="qrModalClose" style="position:absolute;top:8px;right:12px;cursor:pointer;font-size:1.5em;color:#388e3c;">&times;</div>
            <div id="qrTitle" style="font-weight:600;color:#217a21;margin-bottom:10px;text-align:center;"></div>
            <div id="qrCode" style="display:flex;justify-content:center;"></div>
            <div id="qrLink" style="margin-top:10px;text-align:center;font-size:0.98em;word-break:break-all;"></div>
            <div style="text-align:center;margin-top:14px;">
                <button id="downloadQRBtn" style="background:#217a21;color:#fff;padding:7px 18px;border-radius:6px;font-weight:600;font-size:1em;border:none;cursor:pointer;">Download QR</button>
            </div>
        </div>
    </div>
    <!-- QRCode.js -->
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <script>
        // --- ƒê·ªìng b·ªô d·ªØ li·ªáu t·ª´ Github v·ªÅ localStorage ---
        function syncProductsFromGithub(callback) {
            fetch('https://minhkhoa0611.github.io/H-FARM/products.json')
                .then(res => res.json())
                .then(arr => {
                    if (Array.isArray(arr)) {
                        localStorage.setItem('hfarm_products', JSON.stringify(arr));
                        if (typeof callback === 'function') callback();
                    }
                })
                .catch(() => {
                    if (typeof callback === 'function') callback();
                });
        }

        // Khi load trang, lu√¥n ƒë·ªìng b·ªô d·ªØ li·ªáu m·ªõi nh·∫•t t·ª´ Github v·ªÅ localStorage tr∆∞·ªõc khi render
        window.addEventListener('DOMContentLoaded', function() {
            syncProductsFromGithub(renderTable);
        });

        // L∆∞u s·∫£n ph·∫©m v√†o localStorage
        function getProducts() {
            return JSON.parse(localStorage.getItem('hfarm_products') || '[]');
        }
        function saveProducts(arr) {
            localStorage.setItem('hfarm_products', JSON.stringify(arr));
        }
        function renderTable() {
            const arr = getProducts();
            const tbody = document.querySelector('#productTable tbody');
            tbody.innerHTML = '';
            arr.forEach((prod, idx) => {
                const priceHtml = Array.isArray(prod.prices) && prod.prices.length
                    ? prod.prices.map(p => `<div>${p.size}: <b>${p.price}</b></div>`).join('')
                    : '';
                // L·∫•y t√™n file t·ª´ link, b·ªè .html n·∫øu c√≥
                let fileName = '';
                if (prod.link) {
                    try {
                        let url = prod.link;
                        let parts = url.split('/');
                        fileName = parts[parts.length - 1] || '';
                        if (fileName.endsWith('.html')) fileName = fileName.slice(0, -5);
                    } catch {}
                }
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${prod.title}</td>
                    <td>${prod.category}</td>
                    <td><a href="${prod.link}" target="_blank">Xem</a></td>
                    <td style="text-align:center;">
                        <span style="font-family:Consolas,Menlo,monospace;color:#217a21;">${fileName}</span>
                        <button type="button" class="copy-filename-btn" data-filename="${fileName}" title="Copy t√™n file" style="background:none;border:none;cursor:pointer;padding:0 4px;">
                            üìã
                        </button>
                        <span class="copied-msg" style="display:none;color:#388e3c;font-size:0.95em;margin-left:4px;">ƒê√£ copy!</span>
                    </td>
                    <td>${prod.note || ''}</td>
                    <td>
                        ${prod.image ? `<img src="${prod.image}" alt="·∫¢nh" style="max-width:60px;max-height:60px;border-radius:6px;border:1px solid #b6e5b6;">` : ''}
                    </td>
                    <td>${priceHtml}</td>
                    <td style="text-align:center;">
                        <button type="button" onclick="showQR(${idx})" style="background:#fff;color:#217a21;border:1px solid #b6e5b6;padding:4px 10px;font-size:0.98em;">L·∫•y m√£ QR</button>
                    </td>
                    <td class="actions">
                        <button type="button" onclick="editProduct(${idx})">S·ª≠a</button>
                        <button type="button" onclick="deleteProduct(${idx})" style="background:#e53935;">X√≥a</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });

    // Th√™m s·ª± ki·ªán copy cho t·∫•t c·∫£ n√∫t copy-filename-btn
    tbody.querySelectorAll('.copy-filename-btn').forEach(btn => {
        btn.onclick = function() {
            const filename = btn.getAttribute('data-filename');
            navigator.clipboard.writeText(filename).then(() => {
                const msg = btn.parentElement.querySelector('.copied-msg');
                if (msg) {
                    msg.style.display = 'inline';
                    setTimeout(() => { msg.style.display = 'none'; }, 1200);
                }
            });
        };
    });
        }
        // X·ª≠ l√Ω ch·ªçn ·∫£nh v√† preview, upload l√™n Github n·∫øu c√≥ file
let prodImageData = '';
let prodImageGithubUrl = '';
document.getElementById('prodImage').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(evt) {
            prodImageData = evt.target.result;
            document.getElementById('prodImagePreview').innerHTML =
                `<img src="${prodImageData}" style="max-width:100px;max-height:100px;border-radius:8px;border:1px solid #b6e5b6;">`;
            // T·∫£i ·∫£nh l√™n Github
            uploadImageToGithub(file, prodImageData, function(url) {
                if (url) {
                    prodImageGithubUrl = url;
                    document.getElementById('prodImagePreview').innerHTML =
                        `<img src="${prodImageGithubUrl}" style="max-width:100px;max-height:100px;border-radius:8px;border:1px solid #b6e5b6;">`;
                } else {
                    prodImageGithubUrl = '';
                }
            });
        };
        reader.readAsDataURL(file);
    } else {
        prodImageData = '';
        prodImageGithubUrl = '';
        document.getElementById('prodImagePreview').innerHTML = '';
    }
});

// H√†m upload ·∫£nh l√™n Github, tr·∫£ v·ªÅ URL qua callback
function uploadImageToGithub(file, dataUrl, callback) {
    // L·∫•y token t·ª´ Google Apps Script
    fetch('https://script.google.com/macros/s/AKfycbwUZ5jzf34qM4fWIiCaWFUElqRnkMuQqGgITrr0KdE0pMmfo9ejeWEFCLFzmL4okYwi/exec')
        .then(res => res.text())
        .then(text => {
            let token = '';
            const match = text.match(/Token ƒë√£ l∆∞u:\s*([a-zA-Z0-9_]+)/);
            if (match) token = match[1];
            if (!token) {
                alert('Kh√¥ng l·∫•y ƒë∆∞·ª£c token Github ƒë·ªÉ upload ·∫£nh!');
                return;
            }
            // T·∫°o t√™n file duy nh·∫•t
            const ext = file.name.split('.').pop().toLowerCase();
            const imgName = 'img_' + Date.now() + '_' + Math.floor(Math.random()*10000) + '.' + ext;
            const githubPath = `posts/images/${imgName}`;
            const githubUrl = `https://raw.githubusercontent.com/Minhkhoa0611/H-FARM/main/posts/images/${imgName}`;
            // Ki·ªÉm tra file ƒë√£ t·ªìn t·∫°i ch∆∞a ƒë·ªÉ l·∫•y sha
            fetch(`https://api.github.com/repos/Minhkhoa0611/H-FARM/contents/${githubPath}`, {
                headers: { Authorization: `token ${token}` }
            })
            .then(res => res.ok ? res.json() : null)
            .then(fileData => {
                const body = {
                    message: "Upload image for product",
                    content: dataUrl.split(',')[1],
                    branch: "main"
                };
                if (fileData && fileData.sha) body.sha = fileData.sha;
                fetch(`https://api.github.com/repos/Minhkhoa0611/H-FARM/contents/${githubPath}`, {
                    method: "PUT",
                    headers: {
                        "Authorization": `token ${token}`,
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(body)
                })
                .then(r => r.json())
                .then(resp => {
                    if (resp.content && resp.content.download_url) {
                        callback(githubUrl);
                    } else {
                        alert('Upload ·∫£nh th·∫•t b·∫°i!');
                        callback('');
                    }
                })
                .catch(() => {
                    alert('L·ªói khi upload ·∫£nh!');
                    callback('');
                });
            });
        });
}

        // Gi√° ƒë·ªông
let priceArr = [];
function renderPriceInputs() {
    const priceList = document.getElementById('price-list');
    priceList.innerHTML = '';
    priceArr.forEach((item, idx) => {
        const wrap = document.createElement('div');
        wrap.style.display = 'flex';
        wrap.style.gap = '8px';
        wrap.style.marginBottom = '4px';
        wrap.innerHTML = `
            <input type="text" placeholder="Dung t√≠ch (vd: 500ml)" value="${item.size}" style="flex:1;">
            <input type="text" placeholder="Gi√° (vd: 120.000ƒë)" value="${item.price}" style="flex:1;">
            <button type="button" style="background:#e53935;color:#fff;" title="X√≥a">√ó</button>
        `;
        // X·ª≠ l√Ω s·ª± ki·ªán
        wrap.children[0].oninput = e => { priceArr[idx].size = e.target.value; };
        wrap.children[1].oninput = e => { priceArr[idx].price = e.target.value; };
        wrap.children[2].onclick = () => { priceArr.splice(idx,1); renderPriceInputs(); };
        priceList.appendChild(wrap);
    });
}
document.getElementById('addPriceBtn').onclick = function() {
    priceArr.push({size:'', price:''});
    renderPriceInputs();
};
        function resetForm() {
            document.getElementById('editIndex').value = '';
            document.getElementById('prodTitle').value = '';
            document.getElementById('prodLink').value = '';
            document.getElementById('prodCategory').value = '';
            document.getElementById('prodNote').value = '';
            document.getElementById('prodImage').value = '';
            prodImageData = '';
            prodImageGithubUrl = '';
            document.getElementById('prodImagePreview').innerHTML = '';
            document.getElementById('saveBtn').textContent = 'Th√™m m·ªõi';
            priceArr = [];
            renderPriceInputs();
        }
        document.getElementById('productForm').onsubmit = function(e) {
            e.preventDefault();
            const idx = document.getElementById('editIndex').value;
            const title = document.getElementById('prodTitle').value.trim();
            const link = document.getElementById('prodLink').value.trim();
            const category = document.getElementById('prodCategory').value.trim();
            const note = document.getElementById('prodNote').value.trim();
            // Ghi link ·∫£nh Github v√†o json, kh√¥ng ghi base64
            const image = prodImageGithubUrl || '';
            if (!title || !link || !category) return;
            // L·ªçc c√°c m·ª©c gi√° h·ª£p l·ªá
            const prices = priceArr.filter(x => x.size.trim() && x.price.trim());
            let arr = getProducts();
            if (idx === '') {
                arr.push({ title, link, category, note, image, prices });
            } else {
                arr[idx] = { title, link, category, note, image, prices };
            }
            saveProducts(arr);
            renderTable();
            resetForm();
        };
        document.getElementById('resetBtn').onclick = resetForm;
        window.editProduct = function(idx) {
            const arr = getProducts();
            const prod = arr[idx];
            document.getElementById('editIndex').value = idx;
            document.getElementById('prodTitle').value = prod.title;
            document.getElementById('prodLink').value = prod.link;
            document.getElementById('prodCategory').value = prod.category;
            document.getElementById('prodNote').value = prod.note || '';
            prodImageData = '';
            prodImageGithubUrl = prod.image || '';
            document.getElementById('prodImage').value = '';
            document.getElementById('prodImagePreview').innerHTML = prod.image
                ? `<img src="${prod.image}" style="max-width:100px;max-height:100px;border-radius:8px;border:1px solid #b6e5b6;">`
                : '';
            priceArr = Array.isArray(prod.prices) ? prod.prices.map(x => ({...x})) : [];
            renderPriceInputs();
            document.getElementById('saveBtn').textContent = 'L∆∞u';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        };
        window.deleteProduct = function(idx) {
            if (!confirm('B·∫°n ch·∫Øc ch·∫Øn mu·ªën x√≥a s·∫£n ph·∫©m n√†y?')) return;
            let arr = getProducts();
            arr.splice(idx, 1);
            saveProducts(arr);
            renderTable();
            resetForm();
        };
        // Kh·ªüi t·∫°o b·∫£ng khi load
        renderTable();

        // --- L∆∞u l√™n Github ---
        document.getElementById('saveToGithubBtn').onclick = function() {
            const githubProgressDiv = document.getElementById('github-progress');
            const githubLinkDiv = document.getElementById('github-link');
            githubProgressDiv.textContent = "ƒêang l∆∞u l√™n m√°y ch·ªß...";
            githubLinkDiv.innerHTML = "";
            // L·∫•y token t·ª´ Google Apps Script
            fetch('https://script.google.com/macros/s/AKfycbwUZ5jzf34qM4fWIiCaWFUElqRnkMuQqGgITrr0KdE0pMmfo9ejeWEFCLFzmL4okYwi/exec')
                .then(res => res.text())
                .then(text => {
                    let token = '';
                    const match = text.match(/Token ƒë√£ l∆∞u:\s*([a-zA-Z0-9_]+)/);
                    if (match) token = match[1];
                    if (!token) {
                        githubProgressDiv.textContent = "Kh√¥ng l·∫•y ƒë∆∞·ª£c token m√°y ch·ªß!";
                        return;
                    }
                    githubProgressDiv.textContent = "ƒêang ki·ªÉm tra file tr√™n m√°y ch·ªß...";
                    // L∆∞u d∆∞·ªõi d·∫°ng JSON, c√≥ th·ªÉ ƒë·ªïi th√†nh HTML n·∫øu mu·ªën
                    const products = getProducts();
                    const content = btoa(unescape(encodeURIComponent(JSON.stringify(products, null, 2))));
                    const githubPath = "products.json";
                    const githubWebUrl = "https://minhkhoa0611.github.io/H-FARM/products.json";
                    // Ki·ªÉm tra file ƒë√£ t·ªìn t·∫°i ch∆∞a ƒë·ªÉ l·∫•y sha
                    fetch(`https://api.github.com/repos/Minhkhoa0611/H-FARM/contents/${githubPath}`, {
                        headers: { Authorization: `token ${token}` }
                    })
                    .then(res => res.ok ? res.json() : null)
                    .then(fileData => {
                        githubProgressDiv.textContent = "ƒêang t·∫£i file l√™n m√°y ch·ªß...";
                        const body = {
                            message: "C·∫≠p nh·∫≠t danh s√°ch s·∫£n ph·∫©m",
                            content: content,
                            branch: "main"
                        };
                        if (fileData && fileData.sha) body.sha = fileData.sha;
                        fetch(`https://api.github.com/repos/Minhkhoa0611/H-FARM/contents/${githubPath}`, {
                            method: "PUT",
                            headers: {
                                "Authorization": `token ${token}`,
                                "Content-Type": "application/json"
                            },
                            body: JSON.stringify(body)
                        })
                        .then(r => r.json())
                        .then(resp => {
                            if (resp.content && resp.content.download_url) {
                                githubProgressDiv.textContent = "ƒê√£ l∆∞u l√™n m√°y ch·ªß th√†nh c√¥ng!";
                                githubLinkDiv.innerHTML = `<a href="${githubWebUrl}" target="_blank" style="color:#388e3c;font-weight:600;text-decoration:underline;">Xem file tr√™n m√°y ch·ªß</a>`;
                            } else {
                                githubProgressDiv.textContent = "L∆∞u l√™n m√°y ch·ªß th·∫•t b·∫°i! " + (resp.message || '');
                                githubLinkDiv.innerHTML = "";
                            }
                        })
                        .catch(() => {
                            githubProgressDiv.textContent = "L·ªói khi t·∫£i file l√™n m√°y ch·ªß!";
                            githubLinkDiv.innerHTML = "";
                        });
                    });
                })
                .catch(() => {
                    githubProgressDiv.textContent = "Kh√¥ng l·∫•y ƒë∆∞·ª£c token m√°y ch·ªß!";
                });
        };

        // QR Modal logic
        window.showQR = function(idx) {
            const arr = getProducts();
            const prod = arr[idx];
            document.getElementById('qrTitle').textContent = prod.title;
            document.getElementById('qrLink').textContent = prod.link;
            const qrDiv = document.getElementById('qrCode');
            qrDiv.innerHTML = '';
            // S·ª≠ d·ª•ng QRCodeStyling n·∫øu c√≥, ƒë·ªÉ QR ƒë·∫πp nh∆∞ index.html
            if (window.QRCodeStyling) {
                qrDiv.innerHTML = '';
                const qr = new QRCodeStyling({
                    width: 320,
                    height: 320,
                    data: prod.link,
                    image: "image.png",
                    dotsOptions: { color: "#000000", type: "rounded" },
                    backgroundOptions: { color: "#eafbe7" },
                    cornersSquareOptions: { type: "extra-rounded", color: "#000000" },
                    cornersDotOptions: { type: "dot", color: "#000000" },
                    imageOptions: {
                        crossOrigin: "anonymous",
                        margin: 2,
                        imageSize: 0.28,
                        hideBackgroundDots: false,
                        borderRadius: 16
                    }
                });
                qr.append(qrDiv);
                // N√∫t download
                const btn = document.getElementById('downloadQRBtn');
                btn.onclick = function() {
                    qr.download({ name: (prod.title || 'qr'), extension: "png" });
                };
            } else {
                // Fallback: QRCode.js (kh√¥ng c√≥ logo, ch·ªâ QR ƒë∆°n gi·∫£n)
                new QRCode(qrDiv, {
                    text: prod.link,
                    width: 320,
                    height: 320,
                    colorDark : "#000000",
                    colorLight : "#eafbe7",
                    correctLevel : QRCode.CorrectLevel.H
                });
                // N√∫t download kh√¥ng h·ªó tr·ª£
                const btn = document.getElementById('downloadQRBtn');
                btn.onclick = null;
            }
            document.getElementById('qrModal').style.display = 'flex';
        };

        // ƒê√≥ng popup QR khi click n√∫t ƒë√≥ng ho·∫∑c click ra ngo√†i
        document.getElementById('qrModalClose').onclick = function() {
            document.getElementById('qrModal').style.display = 'none';
            document.getElementById('qrCode').innerHTML = '';
        };
        document.getElementById('qrModal').onclick = function(e) {
            if (e.target === this) {
                this.style.display = 'none';
                document.getElementById('qrCode').innerHTML = '';
            }
        };
    </script>
</body>

</html>

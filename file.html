<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>L·∫•y danh s√°ch file HTML</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 600px; margin: 30px auto; padding: 20px; line-height: 1.6; }
    input, button, textarea { width: 100%; padding: 10px; margin-top: 10px; font-size: 16px; }
    button { cursor: pointer; }
  </style>
</head>
<body>
  <h2>üóÇÔ∏è L·∫•y danh s√°ch file HTML t·ª´ GitHub</h2>
  <!-- ·∫®n √¥ nh·∫≠p URL -->
  <input type="text" id="url" style="display:none" value="https://github.com/Minhkhoa0611/H-FARM/tree/main/posts">
  <!-- ·∫®n n√∫t l·∫•y danh s√°ch -->
  <button onclick="fetchFiles()" style="display:none">L·∫•y danh s√°ch</button>
  <textarea id="output" rows="15" placeholder="K·∫øt qu·∫£ s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y..."></textarea>
  <div id="edit-links"></div>

  <script>
    // T·ª± ƒë·ªông l·∫•y danh s√°ch khi t·∫£i trang
    window.onload = function() {
      fetchFiles();
    };

    async function fetchFiles() {
      const url = "https://github.com/Minhkhoa0611/H-FARM/tree/main/posts";
      const output = document.getElementById("output");
      const editLinksDiv = document.getElementById("edit-links");
      output.value = "ƒêang l·∫•y d·ªØ li·ªáu...";
      editLinksDiv.innerHTML = "";

      // Parse GitHub folder URL
      const regex = /^https:\/\/github\.com\/([^\/]+)\/([^\/]+)\/tree\/([^\/]+)\/(.+)$/;
      const match = url.match(regex);
      if (!match) {
        output.value = "URL kh√¥ng h·ª£p l·ªá. H√£y nh·∫≠p ƒë√∫ng ƒë·ªãnh d·∫°ng.";
        return;
      }
      const [, owner, repo, branch, path] = match;

      const apiUrl = `https://api.github.com/repos/${owner}/${repo}/contents/${path}?ref=${branch}`;

      try {
        const res = await fetch(apiUrl);
        if (!res.ok) {
          output.value = "Kh√¥ng th·ªÉ l·∫•y d·ªØ li·ªáu t·ª´ GitHub API.";
          return;
        }
        const data = await res.json();
        const filenames = data
          .filter(item => item.type === "file" && item.name.endsWith(".html"))
          .map(item => item.name.replace(/\.html$/, ''));
        output.value = filenames.length > 0 ? filenames.join('\n') : "Kh√¥ng t√¨m th·∫•y file .html n√†o.";

        // Hi·ªÉn th·ªã link edit
        if (filenames.length > 0) {
          editLinksDiv.innerHTML = "<b>M·ªü trang ch·ªânh s·ª≠a:</b><br>" +
            filenames.map(name =>
              `<a href="https://github.com/${owner}/${repo}/edit/${branch}/${path}/${name}.html" target="_blank">${name}.html</a>`
            ).join("<br>");
        }
      } catch (err) {
        output.value = "L·ªói khi t·∫£i d·ªØ li·ªáu: " + err.message;
      }
    }
  </script>
</body>
</html>
